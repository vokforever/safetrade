# Исправления автопродажи NOCK

## Проблема
Бот не мог продать NOCK из-за ошибки `market.order.insufficient_balance` при попытке создать рыночный ордер на весь баланс.

## Решение
1. **Разбиение больших ордеров**: Большие балансы NOCK теперь разбиваются на несколько меньших ордеров
2. **Использование 99% от баланса**: Чтобы избежать ошибки `insufficient_balance`, используется только 99% от доступного баланса
3. **Специальная обработка для NOCK**: Для NOCK применяется особая логика обработки ордеров

## Основные изменения

### 1. Функция `auto_sell_all_altcoins`
- Для NOCK и балансов > 100: разбивает на несколько частей
- Использует 99% от баланса вместо 100%
- Для NOCK всегда используется множественное разбиение

### 2. Функция `execute_market_sell`
- Специальная обработка для NOCK
- При ошибке `insufficient_balance` пробует с 95% и 90% от суммы
- Дополнительное округление для NOCK до 4 знаков

## Использование

### Автоматическая продажа (раз в час)
```bash
python main.py
```
Бот будет автоматически запускать продажу каждый час согласно настройке `AUTO_SELL_INTERVAL`.

### Принудительная продажа
```bash
python hourly_autosell.py
```
Запускает немедленную продажу всех альткоинов.

### Тестирование
```bash
python test_final_fix.py
```
Запускает тестирование исправлений без реальной продажи (можно прервать до подтверждения).

## Настройка

### В файле `.env`:
```
SAFETRADE_EASY_MODE=true
```
Включает простой режим продажи (рекомендуется для NOCK).

### В файле `config.yml`:
```yaml
trading:
  auto_sell_interval: 3600  # Интервал в секундах (3600 = 1 час)
  min_position_value_usd: 1.0
```

## Логика разбиения ордеров

- Баланс > 500 NOCK: 5 ордеров
- Баланс > 200 NOCK: 3 ордера
- Баланс > 100 NOCK: 2 ордера
- Остальные валюты: 1 ордер с 99% от баланса

## Результаты тестирования

✅ Маленькие ордера (0.01 NOCK) создаются успешно
✅ Средние ордера (8.8 NOCK) создаются успешно
✅ Разбиение больших балансов работает корректно
✅ Использование 99% от баланса решает проблему `insufficient_balance`

## Примечания

- Всегда оставляется 1% от баланса непроданным для избежания ошибок
- Для NOCK используется точность 4 знака после запятой
- Между частями ордеров есть задержка в 1 секунду
- Между разными валютами есть задержка в 2 секунды